{% extends "base.html" %}
{% block content %}
<h2>Seu carrinho</h2>
<p class="muted">Atualize as quantidades ou finalize sua compra.</p>

{% if items and items|length > 0 %}
<form method="post" action="{{ url_for('cart_update') }}">
  <table class="table" style="margin-top:14px">
    <thead>
      <tr>
        <th>Produto</th>
        <th style="width:130px">Pre√ßo</th>
        <th style="width:110px">Qtd.</th>
        <th style="width:150px">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>
          <strong>{{ it.product.name }}</strong>
          <div class="muted" style="margin-top:3px">{{ (it.product.description[:70] ~ '‚Ä¶') if it.product.description and it.product.description|length>70 else (it.product.description or '') }}</div>
        </td>
        <td>R$ {{ "%.2f"|format(it.product.price) }}</td>
        <td><input type="number" name="qty_{{ it.product.id }}" value="{{ it.qty }}" min="0" max="99"></td>
        <td><strong>R$ {{ "%.2f"|format(it.subtotal) }}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="grid" style="grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;align-items:start">
    <div class="card">
      <div class="card-pad">
        <strong>Atualiza√ß√µes</strong>
        <p class="muted" style="margin-top:6px">Defina 0 para remover um item.</p>
        <button class="btn primary block" style="margin-top:12px">Atualizar carrinho</button>
        <a class="btn soft block" style="margin-top:10px" href="{{ url_for('cart_clear') }}">Esvaziar carrinho</a>
      </div>
    </div>

    <div class="card">
      <div class="card-pad">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <strong>Total</strong>
          <strong class="price" style="margin:0">R$ {{ "%.2f"|format(total) }}</strong>
        </div>

        {% if pix_discount_percent() > 0 %}
          {% set pix_total = price_with_pix_discount(total) %}
          {% set eco_total = total - pix_total %}
          <div class="pix" style="margin-top:12px">
            <div class="line1">üí∞ {{ pix_discount_percent() }}% OFF no Pix</div>
            <div class="line2">Economia: R$ {{ "%.2f"|format(eco_total) }} ‚Ä¢ Pix: R$ {{ "%.2f"|format(pix_total) }}</div>
          </div>
        {% endif %}

        <a class="btn primary block" style="margin-top:12px" href="{{ url_for('checkout') }}">Finalizar compra</a>
      </div>
    </div>
  </div>
</form>
{% else %}
  <div class="card"><div class="card-pad">Seu carrinho est√° vazio. <a href="{{ url_for('index') }}"><strong>Voltar ao cat√°logo</strong></a></div></div>
{% endif %}
{% endblock %}
